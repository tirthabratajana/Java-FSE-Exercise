<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Community Event Portal</title>
    <style>
        #welcomeBanner {
            background-color: blue;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .highlight {
            font-weight: bold;
            color: green;
        }
        /* CSS for Task 5 */
        form {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        form div {
            margin-bottom: 10px;
        }
        form label {
            display: block;
            margin-bottom: 5px;
        }
        form input[type="text"],
        form input[type="email"],
        form input[type="date"],
        form select,
        form textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        form button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        form button:hover {
            background-color: #218838;
        }
        output {
            display: block;
            margin-top: 10px;
            padding: 10px;
            background-color: #e2f0cb;
            border: 1px solid #a4c639;
            border-radius: 4px;
        }
        /* CSS for Task 4 Image Gallery */
        .event-image {
            border: 2px solid purple;
            width: 150px; /* Adjust size as needed */
            height: 100px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#events">Events</a></li>
            <li><a href="#contact">Contact</a></li>
            <li><a href="help.html" target="_blank">Help Document</a></li>
        </ul>
    </nav>

    <main>
        <section id="home">
            <div id="welcomeBanner">
                <h1>Welcome to our Community Event Portal!</h1>
                <p>Enjoy our <span style="color: red; font-weight: bold;">special offer</span> on upcoming events!</p>
            </div>
            <p>This is the home section. Discover local events and services. Some text with <span class="highlight">important information</span> to highlight.</p>
        </section>

        <section id="events">
            <h2>Upcoming Events</h2>
            <p>Check out the latest events happening in our community.</p>

            <h3>Event Gallery</h3>
            <table>
                <tr>
                    <td>
                        <img src="https://st4.depositphotos.com/2853475/22379/i/450/depositphotos_223793930-stock-photo-group-young-happy-friends-having.jpg" alt="Community Picnic" title="A fun community picnic" class="event-image">
                        <p>Community Picnic</p>
                    </td>
                    <td>
                        <img src="https://a.cdn-hotels.com/gdcs/production47/d114/e915fd36-ea8b-45ed-807f-e5a689716934.jpg" alt="Local Market" title="Local farmers market" class="event-image">
                        <p>Local Market</p>
                    </td>
                    <td>
                        <img src="https://th.bing.com/th/id/OIP.-0qAu-Ixd9LcHZQNq5rA-wAAAA?cb=iwp2&rs=1&pid=ImgDetMain" alt="Music Festival" title="Annual music festival" class="event-image">
                        <p>Music Festival</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="https://www.jacksonsart.com/blog/wp-content/uploads/2020/01/Mall-Gallery-Main-Gallery-Exhibition-Hire.jpg" alt="Art Exhibition" title="Local art exhibition" class="event-image">
                        <p>Art Exhibition</p>
                    </td>
                    <td>
                        <img src="https://www.bartscharity.org.uk/wp-content/uploads/2020/08/10k-runner-scaled-1-1920x1080.jpg" alt="Charity Run" title="Annual charity run" class="event-image">
                        <p>Charity Run</p>
                    </td>
                    <td>
                        <img src="https://th.bing.com/th/id/OIP.6_SbuuP_6BB3KLeUdruAPQHaE8?cb=iwp2&rs=1&pid=ImgDetMain" alt="Book Club Meeting" title="Monthly book club meeting" class="event-image">
                        <p>Book Club Meeting</p>
                    </td>
                </tr>
            </table>

            <h3>Register for an Event</h3>
            <form onsubmit="event.preventDefault(); displayConfirmation();">
                <div>
                    <label for="eventName">Event Name:</label>
                    <input type="text" id="eventName" name="eventName" placeholder="e.g., Summer Festival" required autofocus>
                </div>
                <div>
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
                </div>
                <div>
                    <label for="eventDate">Date:</label>
                    <input type="date" id="eventDate" name="eventDate" required>
                </div>
                <div>
                    <label for="eventType">Event Type:</label>
                    <select id="eventType" name="eventType" onchange="displayEventFee(this.value)">
                        <option value="">--Select--</option>
                        <option value="Workshop">Workshop</option>
                        <option value="Concert">Concert</option>
                        <option value="Sport">Sport</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="eventFee">Event Fee:</label>
                    <span id="eventFee"></span>
                </div>
                <div>
                    <label for="message">Message:</label>
                    <textarea id="message" name="message" rows="4" placeholder="Any special requests?" onkeyup="countCharacters(this)"></textarea>
                    <p>Characters remaining: <span id="charCount">500</span></p>
                </div>
                <div>
                    <label for="phoneNumber">Phone Number (e.g., 123-456-7890):</label>
                    <input type="text" id="phoneNumber" onblur="validatePhoneNumber(this.value)">
                    <span id="phoneError" style="color: red;"></span>
                </div>
                <button type="submit" onclick="showSubmitConfirmation()">Register</button>
                <output for="eventName email eventDate eventType message" id="confirmationOutput"></output>
            </form>

            <h3>Event Promo Video</h3>
            <video id="promoVideo" width="320" height="240" controls oncanplay="displayVideoReadyMessage()">
                <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <p id="videoStatus"></p>
        </section>

        <section id="contact">
            <h2>Contact Us</h2>
            <p>Get in touch with us for any inquiries.</p>
        </section>

        <section id="userPreferences">
            <h2>User Preferences</h2>
            <div>
                <label for="preferredEventType">Preferred Event Type:</label>
                <select id="preferredEventType" onchange="savePreferredEventType(this.value)">
                    <option value="">--Select--</option>
                    <option value="Workshop">Workshop</option>
                    <option value="Concert">Concert</option>
                    <option value="Sport">Sport</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <button onclick="clearPreferences()">Clear Preferences</button>
        </section>

        <section id="geolocation">
            <h2>Find Nearby Events</h2>
            <button onclick="findNearbyEvents()">Find Nearby Events</button>
            <p id="coordinates"></p>
            <p id="geoError" style="color: red;"></p>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Local Community Event Portal</p>
    </footer>

    <script>
        // Task 3: Display welcome banner (handled by CSS) and inline style for span (handled by inline style)
        // Highlight class applied to some text in the home section.

        // Task 6: Event Handling
        function validatePhoneNumber(phoneNumber) {
            const phoneError = document.getElementById('phoneError');
            const pattern = /^\d{3}-\d{3}-\d{4}$/; // Basic pattern: XXX-XXX-XXXX
            if (!pattern.test(phoneNumber)) {
                phoneError.textContent = 'Invalid phone number format (e.g., 123-456-7890)';
            } else {
                phoneError.textContent = '';
            }
        }

        function displayEventFee(eventType) {
            const eventFeeSpan = document.getElementById('eventFee');
            let fee = '';
            switch (eventType) {
                case 'Workshop':
                    fee = '$25';
                    break;
                case 'Concert':
                    fee = '$50';
                    break;
                case 'Sport':
                    fee = '$10';
                    break;
                case 'Other':
                    fee = 'Varies';
                    break;
                default:
                    fee = '';
            }
            eventFeeSpan.textContent = fee;
        }

        function showSubmitConfirmation() {
            alert('Form submitted! (This is an onclick confirmation)');
        }

        const imageForDblClick = document.querySelector('#events table img');
        if (imageForDblClick) {
            imageForDblClick.ondblclick = function() {
                alert('Image enlarged! (Simulated double-click event)'); // In a real app, you'd change image size
                // For demonstration, let's just make it bigger briefly
                this.style.width = '300px';
                this.style.height = '200px';
                setTimeout(() => {
                    this.style.width = '150px';
                    this.style.height = '100px';
                }, 1000);
            };
        }


        function countCharacters(textarea) {
            const maxLength = 500;
            const currentLength = textarea.value.length;
            const remaining = maxLength - currentLength;
            document.getElementById('charCount').textContent = remaining;
            if (remaining < 0) {
                document.getElementById('charCount').style.color = 'red';
            } else {
                document.getElementById('charCount').style.color = 'black';
            }
        }

        // Task 5: Display confirmation message
        function displayConfirmation() {
            const eventName = document.getElementById('eventName').value;
            const email = document.getElementById('email').value;
            const eventDate = document.getElementById('eventDate').value;
            const eventType = document.getElementById('eventType').value;
            const message = document.getElementById('message').value;

            const output = document.getElementById('confirmationOutput');
            output.innerHTML = `
                <h3>Registration Details:</h3>
                <p><strong>Event Name:</strong> ${eventName}</p>
                <p><strong>Email:</strong> ${email}</p>
                <p><strong>Date:</strong> ${eventDate}</p>
                <p><strong>Event Type:</strong> ${eventType || 'Not selected'}</p>
                <p><strong>Message:</strong> ${message || 'No message'}</p>
                <p>Thank you for registering!</p>
            `;
        }

        // Task 7: Video Invite with Media Events
        function displayVideoReadyMessage() {
            document.getElementById('videoStatus').textContent = 'Video ready to play!';
        }

        window.onbeforeunload = function() {
            const formElements = document.querySelector('form').elements;
            let formIsDirty = false;
            for (let i = 0; i < formElements.length; i++) {
                const element = formElements[i];
                if (element.type !== 'submit' && element.value !== '' && element.id !== 'confirmationOutput') {
                    formIsDirty = true;
                    break;
                }
            }
            if (formIsDirty) {
                return "You have unsaved changes. Are you sure you want to leave?";
            }
        };

        // Task 8: Saving User Preferences
        function savePreferredEventType(eventType) {
            if (eventType) {
                localStorage.setItem('preferredEventType', eventType);
                console.log('Preferred event type saved:', eventType);
            } else {
                localStorage.removeItem('preferredEventType');
                console.log('Preferred event type cleared from localStorage.');
            }
        }

        function loadPreferredEventType() {
            const preferredEventType = localStorage.getItem('preferredEventType');
            if (preferredEventType) {
                document.getElementById('preferredEventType').value = preferredEventType;
                console.log('Preferred event type loaded:', preferredEventType);
            }
        }

        function clearPreferences() {
            localStorage.clear();
            sessionStorage.clear();
            document.getElementById('preferredEventType').value = '';
            alert('All preferences cleared from localStorage and sessionStorage.');
            console.log('localStorage and sessionStorage cleared.');
        }

        // Load preferences on page load
        window.onload = loadPreferredEventType;

        // Task 9: Geolocation for Event Mapping
        function findNearbyEvents() {
            const coordinatesElement = document.getElementById('coordinates');
            const geoErrorElement = document.getElementById('geoError');
            coordinatesElement.textContent = '';
            geoErrorElement.textContent = '';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        coordinatesElement.textContent = `Latitude: ${lat}, Longitude: ${lon}`;
                    },
                    (error) => {
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                geoErrorElement.textContent = "Geolocation permission denied. Please enable location access in your browser settings.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                geoErrorElement.textContent = "Location information is unavailable.";
                                break;
                            case error.TIMEOUT:
                                geoErrorElement.textContent = "The request to get user location timed out.";
                                break;
                            case error.UNKNOWN_ERROR:
                                geoErrorElement.textContent = "An unknown error occurred.";
                                break;
                        }
                        console.error("Geolocation error:", error);
                    }, {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                geoErrorElement.textContent = "Geolocation is not supported by your browser.";
            }
        }
    </script>
</body>
</html>